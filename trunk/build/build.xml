<project default="dexter-jar">

	<property  file="build.properties" />

	<property name="RELEASENAME" value="dexter-${dexter.version}" />
	<property name="STAGINGDIR" value="${build.staging}" />
	<property name="PACKAGEDIR" value="${STAGINGDIR}/${RELEASENAME}" />
	<property name="DOCSOURCE" value ="../docs" />

	<target name="rebuild" depends="clean,all" />
	<target name="all" depends="dexter-jar,docs" />
	<target name="docs" depends="dexter-javadoc" />


	<target name="clean" description="clean the output files">
		<delete failonerror="no">
			<fileset dir=".">
				<include name="dexter.jar" />
			</fileset>
			<fileset dir="../bin">
				<include name="**/*.class" />
			</fileset>
		</delete>
	</target>

	<target name="package" depends="rebuild">
		<delete dir="${PACKAGEDIR}">
		</delete>
		<copy todir="${PACKAGEDIR}">
			<fileset dir="..">
				<include name="src/**/*.*" />
			</fileset>
		</copy>

		<copy todir="${PACKAGEDIR}" file="LICENSE.txt" />
		<copy todir="${PACKAGEDIR}" file="README.txt" />
		<copy todir="${PACKAGEDIR}" file="CHANGES.txt" />

		<copy todir="${PACKAGEDIR}/build" file="dexter.jar" />
		<copy todir="${PACKAGEDIR}/build" file="build.xml" />
		<copy todir="${PACKAGEDIR}/build" file="build.properties" />
		<copy todir="${PACKAGEDIR}/build" file="LICENSE.txt" />
		<copy todir="${PACKAGEDIR}/build" file="README.txt" />
		<copy todir="${PACKAGEDIR}/build" file="CHANGES.txt" />

		<copy todir="${PACKAGEDIR}/docs" file="${DOCSOURCE}/index.xml" />
		<copy todir="${PACKAGEDIR}/docs" file="${DOCSOURCE}/dexter-user-guide.xml" />
		<copy todir="${PACKAGEDIR}/docs" file="${DOCSOURCE}/dexter-api.xml" />
		<copy todir="${PACKAGEDIR}/docs" file="${DOCSOURCE}/dexter.meta" />
		<copy todir="${PACKAGEDIR}/docs" file="${DOCSOURCE}/docster.html" />
		<copy todir="${PACKAGEDIR}/docs" file="${DOCSOURCE}/docster.html.xsl" />
		<copy todir="${PACKAGEDIR}/docs" file="${DOCSOURCE}/style.css" />

		<copy todir="${PACKAGEDIR}/docs">
			<fileset dir="${DOCSOURCE}">
				<include name="javadoc/**/*.*" />
			</fileset>
		</copy>

		<zip destfile="${RELEASENAME}.zip">
			<fileset dir="${STAGINGDIR}">
				<include name="${RELEASENAME}/**/*.*" />
				<include name="${RELEASENAME}/**/*" />
			</fileset>
		</zip>
	</target>

	<target name="dexter-javadoc">
		<javadoc destdir="${DOCSOURCE}/javadoc">
			<fileset dir="../src">
				<include name="**/*.java" />
			</fileset>
		</javadoc>
	</target>

	<target name="compile">
		<mkdir dir="../bin"/>
		<javac destdir="../bin" srcdir="../src" debug="yes" failonerror="true" />
	</target>

		
	<target name="dexter-jar" depends="compile">
		<jar destfile="dexter.jar">
			<manifest>
				<attribute name="Main-Class" value="org.dykman.dexter.Dexter" />
				<attribute name="Version" value="${RELEASENAME}" />
			</manifest>

			<fileset dir="../bin">
				<include name="**/*.class" />
			</fileset>
			<fileset dir="../src">
				<include name="**/*.properties" />
			</fileset>
			<fileset dir=".">
				<include name="LICENSE.txt" />
			</fileset>
		</jar>
	</target>
</project>
