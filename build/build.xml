<project default="all">
	<property name="RELEASENAME" value="dexter-0.1.4-beta" />
	<property name="STAGINGDIR" value="/tmp" />
	<property name="PACKAGEDIR" value="${STAGINGDIR}/${RELEASENAME}" />
	<property name ="DOCSDIR" value ="../docs" />
	
	<target name="rebuild" depends="clean,all" />
	<target name="all" depends="dexter-jar,wiki-docs" />

	<target name="clean" description="clean the output files">
		<delete>
			<fileset dir=".">
				<include name="dexter.jar" />
			</fileset>
			<fileset dir="../bin">
				<include name="**/*.class" />
			</fileset>
		</delete>
	</target>

	<target name="package" depends="rebuild,dexter-javadoc">
		<delete dir="${PACKAGEDIR}">
		</delete>
		<copy todir="${PACKAGEDIR}">
			<fileset dir="..">
				<include name="src/**/*.*" />
			</fileset>
		</copy>

		<copy todir="${PACKAGEDIR}" file="LICENSE.txt" />
		<copy todir="${PACKAGEDIR}" file="README.txt" />
		<copy todir="${PACKAGEDIR}" file="CHANGES.txt" />

		<copy todir="${PACKAGEDIR}/build" file="dexter.jar" />
		<copy todir="${PACKAGEDIR}/build" file="build.xml" />
		<copy todir="${PACKAGEDIR}/build" file="LICENSE.txt" />
		<copy todir="${PACKAGEDIR}/build" file="README.txt" />
		<copy todir="${PACKAGEDIR}/build" file="CHANGES.txt" />

		<copy todir="${PACKAGEDIR}/docs" file="../docs/index.xml" />
		<copy todir="${PACKAGEDIR}/docs" file="../docs/dexter-user-guide.xml" />
		<copy todir="${PACKAGEDIR}/docs" file="../docs/dexter-api.xml" />
		<copy todir="${PACKAGEDIR}/docs" file="../docs/dexter.meta" />
		<copy todir="${PACKAGEDIR}/docs" file="../docs/docster.html" />
		<copy todir="${PACKAGEDIR}/docs" file="../docs/docster.html.xsl" />
		<copy todir="${PACKAGEDIR}/docs" file="../docs/wikster.xml" />
		<copy todir="${PACKAGEDIR}/docs" file="../docs/wikster.xml.xsl" />

		<copy todir="${PACKAGEDIR}/docs">
			<fileset dir="${DOCSDIR}">
				<include name="javadoc/**/*.*" />
			</fileset>
		</copy>

		<zip destfile="${RELEASENAME}.zip">
			<fileset dir="${STAGINGDIR}">
				<include name="${RELEASENAME}/**/*.*" />
				<include name="${RELEASENAME}/**/*" />
			</fileset>
		</zip>
	</target>

	<target name="dexter-javadoc">
		<javadoc destdir="${DOCSDIR}/javadoc">
			<fileset dir="../src">
				<include name="**/*.java" />
			</fileset>
		</javadoc>
	</target>

	<target name="compile">
		<mkdir dir="../bin"/>
		<javac destdir="../bin" srcdir="../src" debug="yes" failonerror="true" target="1.5" />
	</target>

	<target name="wiki-docs">
		<java fork="yes" classname="org.dykman.dexter.Transformer">
			<classpath>
				<filelist dir=".">
					<file name="dexter.jar"/>
				</filelist>
			</classpath>
			<arg file="${DOCSDIR}/wikster.xml.xsl"/>
			<arg file="${DOCSDIR}/index.xml"/>
			<arg file="${DOCSDIR}/dexter-api.xml"/>
			<arg file="${DOCSDIR}/dexter-user-guide.xml"/>
		</java>

		<move file="${DOCSDIR}/index.xml.xslout" 
			tofile="${DOCSDIR}/index.xml.wiki"/>
		<move file="${DOCSDIR}/dexter-api.xml.xslout" 
			tofile="${DOCSDIR}/dexter-api.xml.wiki"/>
		<move file="${DOCSDIR}/dexter-user-guide.xml.xslout" 
			tofile="${DOCSDIR}/dexter-user-guide.xml.wiki"/>

	</target>
		
	<target name="dexter-jar" depends="compile">
		<jar destfile="dexter.jar">
			<manifest>
				<attribute name="Main-Class" value="org.dykman.dexter.Dexter" />
				<attribute name="Version" value="${RELEASENAME}" />
			</manifest>

			<fileset dir="../bin">
				<include name="**/*.class" />
			</fileset>
			<fileset dir="../src">
				<include name="**/*.properties" />
			</fileset>
			<fileset dir=".">
				<include name="LICENSE.txt" />
			</fileset>
		</jar>
	</target>
</project>
